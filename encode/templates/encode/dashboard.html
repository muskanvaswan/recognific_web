{% extends 'base.html' %}
{% load static %}
{% block additional_css %}<link rel="stylesheet" href="{% static 'css/index.css' %} ">
{% endblock %}

{% block body %}
<div class=" container p-5">
  <h1>Dashboard</h1>
  <div class="p-5">
    <h5>  Your Classes:</h5>
    <p>Download Attendance for a <input type="text" name="option" value="day" id="option"></p>
    <input type="hidden" name="date" id="date" value="0">
    <input type="hidden" name="month" id="month" value="0">
    <div>

      {% for ClassSet in classes %}
        <div>
          <div class="card m-3">
            <div class="card-body d-flex justify-content-between">
              <h5>{{ ClassSet.name }}</h5>
              <div class="d-flex">
                <button type="button" class="btn btn-primary m-2" data-classname="{{ ClassSet.id }}" onclick="attendance(this)"name="button">Make Attendance Sheet</button>
                <div id="{{ ClassSet.id }}" class="invisible">
                  <button type="button" name="download" class="btn btn-success my-2">
                    <a href="{{ ClassSet.get_file_url }}" type="file/xlsx" download>
                        <i class="fa fa-download"></i>
                    </a>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
    <a href="{% url 'create_classset' %}" class="btn btn-primary"> Create Class </a>
    <a href="{% url 'create_student' %}" class="btn btn-primary"> Create Student </a>


  </div>
  <script type="text/javascript">
    function appendDownload(id){
      document.getElementById(id).className = '';

    }
    function attendance(e){
        var data = JSON.stringify({"option":document.getElementById('option').value,"date":document.getElementById('date').value, "month":document.getElementById('month').value});

        var xhr = new XMLHttpRequest();
        xhr.withCredentials = true;

        xhr.addEventListener("readystatechange", function() {
          if(this.readyState === 4) {
            console.log(this.responseText);
          }
        });

        xhr.open("POST", `http://127.0.0.1:8000/r/api/make_sheet/${e.dataset.classname}/`);

        xhr.send(data);
        window.setTimeout(appendDownload(e.dataset.classname) ,3000);
    }



  </script>
</div>
{% endblock %}
